'use strict';
const contextPath = $("#container").data("context");
const Folder = new function() {
    this.selected = "";
    this.refresh = function() {
        window.location.reload();
    };
    this.open = function(folderId) {
        Folder.selected = folderId;
        AjaxUtil.GET({
            url: contextPath+"/api/folder/"+folderId,
            callBack: Drive.open
        });
    };
    this.initialize = function() {
        this.selected = "";
        $(".btnCreateFolder").on("click", function(e) {
            e.preventDefault();
            AjaxUtil.POST({
                url: contextPath+"/api/folder",
                data: {name: $("#folder-name").val(), parent :{id: Folder.selected}},
                callBack: Folder.refresh
            });
        });
    };
};

const Drive = new function() {
    this.events = function() {
        $(".folder-name").on("click", function(e) {
            e.preventDefault();
            Folder.open($(this).attr("id"));
        });
    };
    this.open = function(response) {
        var data = response.data;
        $(".driveContent").empty();
        $(".card-subtitle").empty().append("My Drive").append("<i class='fa fa-greater-than'></i>").append(data.name);
    };
    this.load = function(response) {
        $(".driveContent").empty();
        $(".card-subtitle").empty().append("My Drive");
        if(response.data) {
            var counter = 1;
            var divRow = $("<div/>").attr({class: "row"});
            for(let index = 0; index < response.data.length; index++) {
                const divCol = $("<div/>").attr({class: "col-sm-3 col-md-3 col-lg-3 col-xl-3 col-xxl-3 border border-1 rounded-1"});
                const divColR = $("<div/>").attr({class: "row"});
                const divColIcon = $("<div/>").attr({class: "col-sm-1 col-md-1 col-lg-1 col-xl-1 col-xxl-1"});
                divColIcon.append("<i class='fa fa-folder text-success'></i>")
                divColR.append(divColIcon);
                const divColName = $("<a/>").attr({class: "col-sm-9 col-md-9 col-lg-9 col-xl-9 col-xxl-9 folder-name text-decoration-none text-dark", href: "javascript:;", id: response.data[index].id});
                divColName.append(response.data[index].name);
                divColR.append(divColName);
                const divColOptions = $("<a/>").attr({class: "col-sm-1 col-md-1 col-lg-1 col-xl-1 col-xxl-1 folder-options", href: "javascript:;", id: response.data[index].id});
                divColOptions.append('<i class="fa-solid fa-ellipsis-vertical text-dark"></i>');
                divColR.append(divColOptions);
                divCol.append(divColR);
                divRow.append(divCol);
                if(counter==4) {
                    counter = 1
                    $(".driveContent").append(divRow);
                    divRow = $("<div/>").attr({class: "row mt-3"});
                }
                counter++;
            }
            if(counter<4) {
                $(".driveContent").append(divRow);
            }
        }else {
            $(".driveContent").append("Your drive is empty.!");
        }
        Drive.events();
    };
    this.initialize = function() {
        AjaxUtil.GET({
            url: contextPath+"/api/folder",
            callBack: Drive.load
        });
    };
};
Folder.initialize();
Drive.initialize();